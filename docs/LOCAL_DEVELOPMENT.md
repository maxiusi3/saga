# Saga æœ¬åœ°å¼€å‘ç¯å¢ƒæŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ åœ¨æœ¬åœ°è®¾ç½®å’Œè¿è¡Œ Saga åº”ç”¨è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ã€‚

## å‰ç½®è¦æ±‚

ç¡®ä¿ä½ çš„ç³»ç»Ÿå·²å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š

- **Node.js** 18+ 
- **npm** 9+
- **Docker** å’Œ **Docker Compose**
- **Git**

## å¿«é€Ÿå¼€å§‹

### 1. ä¸€é”®è®¾ç½®ç¯å¢ƒ

```bash
# å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone <repository-url>
cd saga-family-biography

# è¿è¡Œè‡ªåŠ¨è®¾ç½®è„šæœ¬
npm run setup
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- å®‰è£…æ‰€æœ‰ä¾èµ–
- å¯åŠ¨ PostgreSQL å’Œ Redis å®¹å™¨
- è¿è¡Œæ•°æ®åº“è¿ç§»
- æ’å…¥æµ‹è¯•æ•°æ®

### 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# åŒæ—¶å¯åŠ¨å‰ç«¯å’Œåç«¯
npm run dev
```

æˆ–è€…åˆ†åˆ«å¯åŠ¨ï¼š

```bash
# ç»ˆç«¯1: å¯åŠ¨åç«¯
npm run dev:backend

# ç»ˆç«¯2: å¯åŠ¨å‰ç«¯  
npm run dev:web
```

### 3. è®¿é—®åº”ç”¨

- **å‰ç«¯åº”ç”¨**: http://localhost:3000
- **åç«¯API**: http://localhost:3001
- **å¥åº·æ£€æŸ¥**: http://localhost:3001/health

## æµ‹è¯•è´¦å·

è®¾ç½®å®Œæˆåï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•è´¦å·ï¼š

- **é‚®ç®±**: test@example.com
- **å¯†ç **: TestPassword123!

## æ•°æ®åº“ä¿¡æ¯

- **Host**: localhost:5432
- **Database**: saga_development
- **Username**: saga_user
- **Password**: saga_password

ä½ å¯ä»¥ä½¿ç”¨ä»»ä½• PostgreSQL å®¢æˆ·ç«¯è¿æ¥åˆ°æ•°æ®åº“æŸ¥çœ‹æ•°æ®ã€‚

## å¸¸ç”¨å‘½ä»¤

### æ•°æ®åº“æ“ä½œ

```bash
# è¿è¡Œè¿ç§»
npm run db:migrate

# æ’å…¥ç§å­æ•°æ®
npm run db:seed

# é‡ç½®æ•°æ®åº“ï¼ˆåˆ é™¤æ‰€æœ‰æ•°æ®å¹¶é‡æ–°è¿ç§»ï¼‰
npm run db:reset
```

### Docker æ“ä½œ

```bash
# å¯åŠ¨æ•°æ®åº“æœåŠ¡
npm run docker:up

# åœæ­¢æ•°æ®åº“æœåŠ¡
npm run docker:down

# æŸ¥çœ‹æ—¥å¿—
npm run docker:logs
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œåç«¯æµ‹è¯•
npm run test:backend

# è¿è¡Œå‰ç«¯æµ‹è¯•
npm run test:web

# è¿è¡ŒE2Eæµ‹è¯•
npm run test:e2e
```

### ä»£ç è´¨é‡

```bash
# è¿è¡Œ ESLint
npm run lint

# ä¿®å¤ ESLint é—®é¢˜
npm run lint:fix

# ç±»å‹æ£€æŸ¥
npm run type-check
```

## API æµ‹è¯•

è¿è¡Œ API æµ‹è¯•è„šæœ¬æ¥éªŒè¯åç«¯æœåŠ¡ï¼š

```bash
./scripts/test-api.sh
```

## å¼€å‘å·¥ä½œæµ

### 1. åŠŸèƒ½å¼€å‘

1. åˆ›å»ºæ–°åˆ†æ”¯
2. ä¿®æ”¹ä»£ç 
3. è¿è¡Œæµ‹è¯•ç¡®ä¿æ²¡æœ‰ç ´åç°æœ‰åŠŸèƒ½
4. æäº¤ä»£ç 

### 2. æ•°æ®åº“æ›´æ”¹

å¦‚æœéœ€è¦ä¿®æ”¹æ•°æ®åº“ç»“æ„ï¼š

1. åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶ï¼š
   ```bash
   cd packages/backend
   npx knex migrate:make migration_name
   ```

2. ç¼–è¾‘è¿ç§»æ–‡ä»¶

3. è¿è¡Œè¿ç§»ï¼š
   ```bash
   npm run db:migrate
   ```

### 3. æ·»åŠ æ–°çš„APIç«¯ç‚¹

1. åœ¨ `packages/backend/src/routes/` ä¸­æ·»åŠ è·¯ç”±
2. åœ¨ `packages/backend/src/controllers/` ä¸­æ·»åŠ æ§åˆ¶å™¨
3. åœ¨ `packages/backend/src/services/` ä¸­æ·»åŠ ä¸šåŠ¡é€»è¾‘
4. æ·»åŠ ç›¸åº”çš„æµ‹è¯•

### 4. å‰ç«¯å¼€å‘

1. åœ¨ `packages/web/src/app/` ä¸­æ·»åŠ é¡µé¢
2. åœ¨ `packages/web/src/components/` ä¸­æ·»åŠ ç»„ä»¶
3. åœ¨ `packages/web/src/stores/` ä¸­ç®¡ç†çŠ¶æ€
4. æ·»åŠ ç›¸åº”çš„æµ‹è¯•

## æ•…éšœæ’é™¤

### ç«¯å£å†²çª

å¦‚æœé‡åˆ°ç«¯å£å†²çªï¼š

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3000
lsof -i :3001
lsof -i :5432
lsof -i :6379

# æ€æ­»å ç”¨ç«¯å£çš„è¿›ç¨‹
kill -9 <PID>
```

### æ•°æ®åº“è¿æ¥é—®é¢˜

```bash
# é‡å¯æ•°æ®åº“å®¹å™¨
docker-compose restart postgres

# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs postgres
```

### ä¾èµ–é—®é¢˜

```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules packages/*/node_modules
npm install
```

### æ•°æ®åº“é‡ç½®

```bash
# å®Œå…¨é‡ç½®æ•°æ®åº“
docker-compose down -v
docker-compose up -d postgres redis
sleep 10
npm run db:migrate
npm run db:seed
```

## ç¯å¢ƒå˜é‡

### åç«¯ç¯å¢ƒå˜é‡ (packages/backend/.env)

ä¸»è¦çš„ç¯å¢ƒå˜é‡å·²ç»åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®å¥½äº†ã€‚å¦‚æœéœ€è¦æµ‹è¯•ç‰¹å®šåŠŸèƒ½ï¼Œä½ å¯èƒ½éœ€è¦é…ç½®ï¼š

- `OPENAI_API_KEY`: OpenAI APIå¯†é’¥ï¼ˆç”¨äºAIæç¤ºç”Ÿæˆï¼‰
- `STRIPE_SECRET_KEY`: Stripeå¯†é’¥ï¼ˆç”¨äºæ”¯ä»˜åŠŸèƒ½ï¼‰
- `AWS_*`: AWSé…ç½®ï¼ˆç”¨äºæ–‡ä»¶ä¸Šä¼ ï¼‰

### å‰ç«¯ç¯å¢ƒå˜é‡ (packages/web/.env.local)

å‰ç«¯ç¯å¢ƒå˜é‡ä¹Ÿå·²ç»é…ç½®å¥½äº†ï¼ŒæŒ‡å‘æœ¬åœ°åç«¯æœåŠ¡ã€‚

## ç”Ÿäº§ç¯å¢ƒå·®å¼‚

æœ¬åœ°å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒçš„ä¸»è¦å·®å¼‚ï¼š

1. **æ•°æ®åº“**: æœ¬åœ°ä½¿ç”¨ Docker PostgreSQLï¼Œç”Ÿäº§ä½¿ç”¨ AWS RDS
2. **æ–‡ä»¶å­˜å‚¨**: æœ¬åœ°æ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ ï¼Œç”Ÿäº§ä½¿ç”¨ AWS S3
3. **è®¤è¯**: æœ¬åœ°ä¸»è¦ä½¿ç”¨é‚®ç®±å¯†ç ï¼Œç”Ÿäº§æ”¯æŒ OAuth
4. **ç›‘æ§**: æœ¬åœ°ç¦ç”¨äº†å¤§éƒ¨åˆ†ç›‘æ§åŠŸèƒ½
5. **å®‰å…¨**: æœ¬åœ°ä½¿ç”¨ç®€åŒ–çš„å®‰å…¨é…ç½®

## è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. æŸ¥çœ‹ Docker å®¹å™¨æ—¥å¿—
3. è¿è¡Œ API æµ‹è¯•è„šæœ¬
4. æ£€æŸ¥æ•°æ®åº“è¿æ¥
5. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†

## ä¸‹ä¸€æ­¥

ç¯å¢ƒè®¾ç½®å®Œæˆåï¼Œä½ å¯ä»¥ï¼š

1. æµè§ˆå‰ç«¯ç•Œé¢ï¼Œäº†è§£ç”¨æˆ·ä½“éªŒ
2. ä½¿ç”¨ API æµ‹è¯•å·¥å…·ï¼ˆå¦‚ Postmanï¼‰æµ‹è¯•åç«¯æ¥å£
3. æŸ¥çœ‹æ•°æ®åº“ç»“æ„å’Œæ•°æ®
4. è¿è¡Œæµ‹è¯•å¥—ä»¶
5. å¼€å§‹å¼€å‘æ–°åŠŸèƒ½

ç¥ä½ å¼€å‘æ„‰å¿«ï¼ğŸš€