# 人工测试指南 - Saga家族传记系统

本指南提供详细的人工测试步骤，涵盖所有8个已完成的任务。

## 🎯 测试概览

### 已完成的8个任务
1. **资源钱包系统** - 包/座位管理和计费
2. **身份验证和用户管理** - OAuth、JWT、用户注册
3. **AI提示系统** - 基于章节的提示和TTS集成
4. **录音和STT管道** - 语音转文字处理和文件处理
5. **故事管理系统** - CRUD操作、交互、摘要
6. **数据导出系统** - PDF/JSON导出和归档功能
7. **Web仪表板** - React基础的协调员界面
8. **移动应用基础** - React Native讲述者界面

## 🚀 测试环境准备

### 1. 启动测试环境

```bash
# 1. 设置测试环境
./scripts/setup-test-environment.sh

# 2. 启动开发服务器
# 终端1 - 后端服务器
cd packages/backend && npm run dev

# 终端2 - Web前端
cd packages/web && npm run dev

# 终端3 - 移动应用（可选）
cd packages/mobile && npm run start
```

### 2. 访问地址
- **Web仪表板**: http://localhost:3000
- **后端API**: http://localhost:3001
- **移动应用**: Metro bundler在8081端口

### 3. 测试账户
系统会自动创建以下测试账户：

**协调员账户1**
- 邮箱: facilitator1@test.com
- 密码: TestPassword123!
- 角色: 协调员
- 初始资源: 1个项目券，2个协调员座位，2个讲述者座位

**协调员账户2**
- 邮箱: facilitator2@test.com
- 密码: TestPassword123!
- 角色: 协调员

**讲述者账户1**
- 邮箱: storyteller1@test.com
- 密码: TestPassword123!
- 角色: 讲述者

**讲述者账户2**
- 邮箱: storyteller2@test.com
- 密码: TestPassword123!
- 角色: 讲述者

## 📋 详细测试场景

### 任务1: 资源钱包系统测试

#### 1.1 用户注册和初始钱包验证
**测试步骤:**
1. 访问 http://localhost:3000/auth/signup
2. 使用新邮箱注册账户
3. 完成注册流程
4. 登录后访问仪表板
5. 检查钱包状态显示

**预期结果:**
- ✅ 新用户获得初始包（1个项目券，2个协调员座位，2个讲述者座位）
- ✅ 钱包状态在仪表板正确显示
- ✅ 资源余额准确

**验证方法:**
- 查看仪表板右上角的钱包状态
- 访问 `/dashboard/wallet` 查看详细余额
- 检查数据库中的 `user_resource_wallets` 表

#### 1.2 项目创建消耗项目券
**测试步骤:**
1. 使用协调员账户登录
2. 点击"创建新项目"
3. 填写项目信息并提交
4. 检查钱包余额变化

**预期结果:**
- ✅ 项目券从1减少到0
- ✅ 项目创建成功
- ✅ 交易记录正确记录

**验证方法:**
- 检查钱包显示的项目券数量
- 查看 `seat_transactions` 表中的交易记录
- 确认项目在项目列表中显示

#### 1.3 邀请用户消耗座位
**测试步骤:**
1. 在已创建的项目中点击"邀请成员"
2. 邀请一个协调员（输入邮箱）
3. 邀请一个讲述者（输入邮箱）
4. 检查座位消耗情况

**预期结果:**
- ✅ 发送邀请时不消耗座位
- ✅ 邀请被接受时才消耗相应座位
- ✅ 协调员座位和讲述者座位分别减少

**验证方法:**
- 发送邀请后检查座位数量（应该不变）
- 接受邀请后检查座位数量（应该减少）
- 查看交易记录确认消耗时机

#### 1.4 资源不足处理
**测试步骤:**
1. 消耗完所有项目券后尝试创建新项目
2. 消耗完所有座位后尝试邀请新成员
3. 检查错误提示和购买提示

**预期结果:**
- ✅ 显示资源不足错误信息
- ✅ 提供购买更多资源的选项
- ✅ 操作被正确阻止

**验证方法:**
- 确认错误消息清晰明确
- 检查购买按钮是否显示
- 验证操作确实被阻止

### 任务2: 身份验证和用户管理测试

#### 2.1 OAuth注册流程
**测试步骤:**
1. 访问注册页面
2. 点击"使用Google登录"（如果配置了）
3. 完成OAuth流程
4. 检查用户创建和会话管理

**预期结果:**
- ✅ OAuth流程顺利完成
- ✅ 用户账户自动创建
- ✅ JWT令牌正确生成
- ✅ 用户重定向到仪表板

**验证方法:**
- 检查浏览器中的JWT令牌
- 确认用户信息在数据库中正确保存
- 验证会话持久性

#### 2.2 JWT令牌管理
**测试步骤:**
1. 登录系统
2. 检查浏览器存储中的JWT令牌
3. 等待令牌接近过期时间
4. 检查自动刷新机制

**预期结果:**
- ✅ 令牌正确存储
- ✅ 令牌包含正确的用户信息
- ✅ 令牌自动刷新
- ✅ 过期令牌正确处理

**验证方法:**
- 使用浏览器开发工具检查localStorage
- 解码JWT令牌验证内容
- 监控网络请求查看刷新调用

#### 2.3 受保护路由访问
**测试步骤:**
1. 未登录状态下访问 `/dashboard`
2. 登录后访问各个受保护页面
3. 令牌过期后尝试访问受保护页面
4. 测试不同角色的权限控制

**预期结果:**
- ✅ 未登录用户被重定向到登录页
- ✅ 已登录用户可以访问授权页面
- ✅ 过期令牌用户被重定向到登录页
- ✅ 角色权限正确执行

**验证方法:**
- 检查重定向行为
- 验证页面内容是否正确加载
- 测试不同角色的访问权限

### 任务3: AI提示系统测试

#### 3.1 章节基础进展
**测试步骤:**
1. 创建新项目
2. 邀请讲述者并接受邀请
3. 讲述者登录移动应用或Web界面
4. 查看第一个提示
5. 录制回答
6. 查看下一个提示

**预期结果:**
- ✅ 第一个提示来自第1章
- ✅ 提示按顺序显示
- ✅ 录制回答后自动进入下一个提示
- ✅ 章节进度正确跟踪

**验证方法:**
- 检查提示内容和章节信息
- 验证 `project_prompt_state` 表中的进度
- 确认提示顺序正确

#### 3.2 用户跟进问题优先级
**测试步骤:**
1. 协调员在故事下添加跟进问题
2. 讲述者查看下一个提示
3. 回答跟进问题
4. 查看后续提示

**预期结果:**
- ✅ 跟进问题优先于AI提示显示
- ✅ 回答跟进问题后返回AI提示序列
- ✅ 优先级系统正确工作

**验证方法:**
- 确认跟进问题首先显示
- 检查 `user_prompts` 表中的优先级设置
- 验证提示队列管理

#### 3.3 文字转语音集成
**测试步骤:**
1. 请求带音频的提示
2. 播放TTS音频
3. 测试音频质量和清晰度
4. 检查音频缓存机制

**预期结果:**
- ✅ TTS音频正确生成
- ✅ 音频质量清晰可听
- ✅ 音频文件正确缓存
- ✅ 播放控件正常工作

**验证方法:**
- 播放音频并检查质量
- 检查音频文件是否缓存
- 验证播放控件功能

#### 3.4 章节完成和摘要生成
**测试步骤:**
1. 完成一个章节的所有提示
2. 检查章节摘要生成
3. 查看摘要内容质量
4. 验证摘要卡片显示

**预期结果:**
- ✅ 章节完成时自动生成摘要
- ✅ 摘要内容准确反映故事内容
- ✅ 摘要卡片正确显示
- ✅ 摘要包含故事统计信息

**验证方法:**
- 检查 `chapter_summaries` 表中的摘要
- 验证摘要内容质量
- 确认摘要卡片在界面中显示

### 任务4: 录音和STT管道测试

#### 4.1 移动应用录音功能
**测试步骤:**
1. 在移动应用中打开录音界面
2. 按住录音按钮开始录音
3. 说话5-10秒
4. 释放按钮停止录音
5. 检查录音质量指示器

**预期结果:**
- ✅ 录音按钮响应正确
- ✅ 录音过程中显示波形可视化
- ✅ 录音质量指示器工作正常
- ✅ 录音时长正确显示

**验证方法:**
- 观察录音界面的视觉反馈
- 检查录音文件是否正确保存
- 验证录音质量指示器

#### 4.2 审查和发送工作流程
**测试步骤:**
1. 完成录音后进入审查界面
2. 播放录音检查质量
3. 测试重新录音功能
4. 点击"发送给家人"
5. 检查上传进度

**预期结果:**
- ✅ 审查界面正确显示
- ✅ 音频播放功能正常
- ✅ 重新录音功能工作
- ✅ 发送功能正确执行
- ✅ 上传进度正确显示

**验证方法:**
- 测试所有审查界面功能
- 检查录音文件上传状态
- 验证用户体验流程

#### 4.3 语音转文字处理
**测试步骤:**
1. 上传音频文件后等待STT处理
2. 检查转录文本准确性
3. 测试转录文本编辑功能
4. 保存编辑后的转录文本

**预期结果:**
- ✅ STT处理在30秒内完成
- ✅ 转录文本基本准确
- ✅ 编辑功能正常工作
- ✅ 编辑内容正确保存

**验证方法:**
- 比较音频内容和转录文本
- 测试编辑界面功能
- 检查保存的转录文本

#### 4.4 文件处理管道
**测试步骤:**
1. 上传不同格式的音频文件
2. 测试文件大小限制（50MB）
3. 测试录音时长限制（10分钟）
4. 检查文件压缩和优化

**预期结果:**
- ✅ 支持常见音频格式
- ✅ 文件大小限制正确执行
- ✅ 时长限制正确执行
- ✅ 文件自动压缩优化

**验证方法:**
- 测试各种音频格式
- 尝试上传超大文件
- 检查压缩后的文件大小

### 任务5: 故事管理系统测试

#### 5.1 故事CRUD操作
**测试步骤:**
1. 创建新故事（通过录音）
2. 查看故事详情
3. 编辑故事元数据
4. 删除故事（软删除）
5. 恢复已删除的故事

**预期结果:**
- ✅ 故事创建成功
- ✅ 故事详情正确显示
- ✅ 编辑功能正常工作
- ✅ 软删除正确执行
- ✅ 恢复功能正常

**验证方法:**
- 检查数据库中的故事记录
- 验证软删除标记
- 确认恢复功能

#### 5.2 故事交互功能
**测试步骤:**
1. 协调员在故事下添加评论
2. 添加跟进问题
3. 测试实时更新（WebSocket）
4. 检查交互历史记录

**预期结果:**
- ✅ 评论正确添加和显示
- ✅ 跟进问题正确创建
- ✅ 实时更新正常工作
- ✅ 交互历史完整记录

**验证方法:**
- 检查评论和问题显示
- 测试多用户实时更新
- 查看交互历史记录

#### 5.3 故事发现和搜索
**测试步骤:**
1. 使用关键词搜索故事
2. 按日期范围筛选
3. 按章节筛选
4. 测试全文搜索功能
5. 检查搜索分析

**预期结果:**
- ✅ 关键词搜索准确
- ✅ 日期筛选正确
- ✅ 章节筛选有效
- ✅ 全文搜索工作正常
- ✅ 搜索分析记录正确

**验证方法:**
- 测试各种搜索条件
- 验证搜索结果准确性
- 检查搜索分析数据

#### 5.4 故事统计和分析
**测试步骤:**
1. 查看项目故事统计
2. 检查故事完成度跟踪
3. 查看故事质量指标
4. 测试故事推荐功能

**预期结果:**
- ✅ 统计数据准确
- ✅ 完成度正确计算
- ✅ 质量指标有意义
- ✅ 推荐算法合理

**验证方法:**
- 验证统计数据准确性
- 检查计算逻辑
- 测试推荐结果

### 任务6: 数据导出系统测试

#### 6.1 PDF导出功能
**测试步骤:**
1. 在项目页面点击"导出PDF"
2. 选择导出选项（包含音频链接、图片等）
3. 等待导出完成
4. 下载并检查PDF质量

**预期结果:**
- ✅ 导出请求正确处理
- ✅ PDF生成在合理时间内完成
- ✅ PDF包含所有故事和元数据
- ✅ 格式美观，内容完整

**验证方法:**
- 检查PDF内容完整性
- 验证格式和布局
- 确认音频链接有效

#### 6.2 JSON导出功能
**测试步骤:**
1. 请求JSON格式导出
2. 下载JSON文件
3. 检查数据结构和完整性
4. 验证数据可以重新导入

**预期结果:**
- ✅ JSON结构正确
- ✅ 数据完整无缺失
- ✅ 格式符合规范
- ✅ 支持重新导入

**验证方法:**
- 解析JSON文件结构
- 验证数据完整性
- 测试导入功能

#### 6.3 归档模式功能
**测试步骤:**
1. 模拟订阅过期
2. 检查项目进入归档模式
3. 测试只读访问权限
4. 验证导出功能仍可用

**预期结果:**
- ✅ 项目正确进入归档模式
- ✅ 编辑功能被禁用
- ✅ 查看功能仍然可用
- ✅ 导出功能正常工作

**验证方法:**
- 尝试编辑操作（应该被阻止）
- 确认查看功能正常
- 测试导出功能

#### 6.4 导出分析和通知
**测试步骤:**
1. 请求多个导出
2. 检查导出状态跟踪
3. 验证完成通知
4. 查看导出分析数据

**预期结果:**
- ✅ 导出状态正确跟踪
- ✅ 完成通知及时发送
- ✅ 分析数据准确记录
- ✅ 错误处理正确

**验证方法:**
- 监控导出状态变化
- 检查通知发送
- 查看分析报告

### 任务7: Web仪表板测试

#### 7.1 项目管理界面
**测试步骤:**
1. 访问项目列表页面
2. 创建新项目
3. 编辑项目详情
4. 管理项目成员
5. 查看项目设置

**预期结果:**
- ✅ 项目列表正确显示
- ✅ 创建功能正常工作
- ✅ 编辑界面用户友好
- ✅ 成员管理功能完整
- ✅ 设置页面功能齐全

**验证方法:**
- 测试所有项目管理功能
- 检查界面响应性
- 验证数据保存正确

#### 7.2 故事信息流界面
**测试步骤:**
1. 访问故事信息流页面
2. 播放音频故事
3. 查看转录文本
4. 添加评论和交互
5. 测试搜索和筛选

**预期结果:**
- ✅ 故事按时间顺序显示
- ✅ 音频播放器正常工作
- ✅ 转录文本正确显示
- ✅ 交互功能响应迅速
- ✅ 搜索筛选有效

**验证方法:**
- 测试音频播放功能
- 验证交互响应性
- 检查搜索结果

#### 7.3 仪表板导航
**测试步骤:**
1. 测试侧边栏导航
2. 检查面包屑导航
3. 验证响应式设计
4. 测试无障碍功能

**预期结果:**
- ✅ 导航菜单清晰直观
- ✅ 面包屑正确显示
- ✅ 移动端适配良好
- ✅ 无障碍标准符合

**验证方法:**
- 在不同设备上测试
- 使用屏幕阅读器测试
- 检查键盘导航

#### 7.4 订阅管理界面
**测试步骤:**
1. 查看订阅状态
2. 管理付款方式
3. 处理订阅续费
4. 查看账单历史

**预期结果:**
- ✅ 订阅状态清晰显示
- ✅ 付款管理功能完整
- ✅ 续费流程顺畅
- ✅ 账单历史准确

**验证方法:**
- 检查订阅信息准确性
- 测试付款流程
- 验证账单数据

### 任务8: 移动应用基础测试

#### 8.1 入门流程
**测试步骤:**
1. 首次打开应用
2. 完成欢迎界面
3. 填写用户信息
4. 接受隐私条款
5. 完成教程

**预期结果:**
- ✅ 欢迎界面友好直观
- ✅ 信息收集流程顺畅
- ✅ 隐私条款清晰明确
- ✅ 教程内容有帮助

**验证方法:**
- 完整走完入门流程
- 检查数据保存正确
- 验证用户体验

#### 8.2 录音界面
**测试步骤:**
1. 查看提示卡片
2. 播放TTS音频
3. 使用录音控件
4. 查看波形可视化
5. 检查录音质量指示器

**预期结果:**
- ✅ 提示显示清晰
- ✅ TTS音频质量好
- ✅ 录音控件响应灵敏
- ✅ 波形可视化准确
- ✅ 质量指示器有用

**验证方法:**
- 测试所有录音功能
- 检查音频质量
- 验证用户界面响应

#### 8.3 无障碍功能
**测试步骤:**
1. 启用屏幕阅读器
2. 测试高对比度模式
3. 检查触摸目标大小
4. 验证字体大小选项
5. 测试语音控制

**预期结果:**
- ✅ 屏幕阅读器兼容
- ✅ 高对比度模式有效
- ✅ 触摸目标≥44x44dp
- ✅ 字体大小可调节
- ✅ 语音控制响应

**验证方法:**
- 使用辅助功能测试
- 检查WCAG 2.1 AA合规性
- 验证用户体验

#### 8.4 故事查看界面
**测试步骤:**
1. 查看已接收的故事
2. 播放音频和查看转录
3. 浏览故事时间线
4. 测试离线功能

**预期结果:**
- ✅ 故事列表正确显示
- ✅ 音频播放流畅
- ✅ 时间线导航直观
- ✅ 离线功能可用

**验证方法:**
- 测试所有查看功能
- 验证离线模式
- 检查数据同步

## 🔄 跨平台集成测试

### 数据同步测试
**测试步骤:**
1. 在Web仪表板创建项目
2. 在移动应用中验证项目显示
3. 在移动应用录制故事
4. 在Web仪表板验证故事显示
5. 在Web添加交互
6. 在移动应用验证通知

**预期结果:**
- ✅ 数据实时同步
- ✅ 跨平台一致性
- ✅ 通知及时送达

### 端到端用户旅程测试
**协调员旅程（Web）:**
1. 注册并创建项目
2. 邀请讲述者
3. 监控故事提交
4. 添加跟进问题
5. 导出项目数据

**讲述者旅程（移动）:**
1. 接受邀请
2. 完成入门流程
3. 录制第一个故事
4. 回应跟进问题
5. 查看家人交互

## 📊 性能测试

### 负载测试
**测试步骤:**
1. 模拟100个并发用户
2. 测试API响应时间
3. 监控数据库性能
4. 检查内存使用情况

**预期结果:**
- ✅ API响应时间<500ms（95%）
- ✅ 数据库查询优化
- ✅ 内存使用稳定

### 移动性能测试
**测试步骤:**
1. 测试应用冷启动时间
2. 验证故事信息流加载时间
3. 测试录音性能
4. 监控电池使用情况

**预期结果:**
- ✅ 冷启动<3秒
- ✅ 信息流加载<2秒
- ✅ 录音性能稳定
- ✅ 电池使用合理

## 🔒 安全测试

### 手动安全测试
**测试步骤:**
1. 尝试SQL注入攻击
2. 测试XSS防护
3. 检查CSRF保护
4. 验证速率限制
5. 测试文件上传安全
6. 尝试身份验证绕过

**预期结果:**
- ✅ 所有攻击被阻止
- ✅ 安全措施有效
- ✅ 错误处理安全

## 📱 设备兼容性测试

### 测试设备矩阵
**iOS设备:**
- iPhone 12+
- iPad（第8代+）
- 不同屏幕尺寸和方向

**Android设备:**
- Pixel系列
- Samsung Galaxy系列
- 不同Android版本

**Web浏览器:**
- Chrome（最新版本）
- Safari（最新版本）
- Firefox（最新版本）

## 🐛 问题报告模板

### 发现问题时请记录：
1. **问题描述**: 详细描述问题
2. **重现步骤**: 逐步重现问题的步骤
3. **预期结果**: 应该发生什么
4. **实际结果**: 实际发生了什么
5. **环境信息**: 设备、浏览器、版本等
6. **截图/视频**: 如果适用
7. **严重程度**: 高/中/低

### 问题严重程度定义：
- **高**: 系统崩溃、数据丢失、安全漏洞
- **中**: 功能无法使用、用户体验差
- **低**: 界面问题、小的功能缺陷

## ✅ 测试完成标准

### 功能要求
- ✅ 所有8个任务的手动测试场景通过
- ✅ 跨平台同步正常工作
- ✅ 性能满足要求
- ✅ 安全测试通过

### 质量指标
- ✅ 测试覆盖率>90%
- ✅ 无障碍性符合WCAG 2.1 AA
- ✅ 无关键安全漏洞
- ✅ 跨平台兼容性良好

### 用户体验
- ✅ 界面直观易用
- ✅ 响应时间满足要求
- ✅ 错误处理友好
- ✅ 帮助文档完整

## 🎉 下一步

测试完成后：

1. **生产部署**
   - 使用 `/infrastructure` 中的脚本
   - 先部署到预发布环境
   - 运行生产冒烟测试

2. **用户验收测试**
   - 招募beta测试用户
   - 收集用户体验反馈
   - 基于真实用户数据迭代

3. **监控设置**
   - 配置错误跟踪（Sentry）
   - 设置性能监控
   - 实施业务指标跟踪

## 📞 支持

如果在测试过程中遇到问题：

1. 查看上面的问题排查部分
2. 检查测试日志中的具体错误信息
3. 验证所有环境变量设置正确
4. 确保所有依赖项已安装

全面的测试套件应该让你确信所有8个任务都正常工作，系统已准备好进行生产部署。